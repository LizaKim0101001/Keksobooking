(()=>{"use strict";var e={d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{w:()=>E});let t=function(e){let t=document.querySelector("#price");return"palace"===e&&(t.placeholder=1e4),"flat"===e&&(t.placeholder=1e3),"house"===e&&(t.placeholder=5e3),"bungalow"===e&&(t.placeholder=0),t.placeholder},o=document.querySelector("#type");o.addEventListener("change",(()=>{let e=o.value;t(e)}));const r=document.querySelector("#price");r.addEventListener("input",(()=>{let e=o.value;const n=r.value;n>1e6?r.setCustomValidity("Цена за жилье не может превышать 1000000"):n<t(e)?r.setCustomValidity("Цена за данный вид жилья не может быть менее "+t(e)):r.setCustomValidity(""),r.reportValidity()}));let n=document.querySelector("#timein"),a=document.querySelector("#timeout");n.addEventListener("change",(()=>{let e=n.value;a.value=e})),a.addEventListener("change",(()=>{let e=a.value;n.value=e}));const c=document.querySelector("#title");c.addEventListener("input",(()=>{const e=c.value.length;e<30?c.setCustomValidity("Ещё "+(30-e)+" симв."):e>100?c.setCustomValidity("Удалите лишние "+(valueLength-100)+" симв."):c.setCustomValidity(""),c.reportValidity()}));const l=document.querySelector("#room_number"),u=document.querySelector("#capacity").querySelectorAll("option");l.addEventListener("change",(()=>{const e=l.value;console.log(e),1==e?(u[0].disabled=!0,u[1].disabled=!0,u[3].disabled=!0,u[2].disabled=!1):2==e?(u[0].disabled=!0,u[3].disabled=!0,u[1].disabled=!1,u[2].disabled=!1):3==e?(u[3].disabled=!0,u[0].disabled=!1,u[1].disabled=!1,u[2].disabled=!1):100==e&&(u[0].disabled=!0,u[1].disabled=!0,u[2].disabled=!0,u[3].disabled=!1)}));const s=function(e,t,o){const r=document.querySelector(t),n=r.querySelectorAll(o);for(let t=0;t<n.length;t++)n[t].disabled=e;e?r.classList.add("ad-form--disabled"):r.classList.remove("ad-form--disabled")};s(!0,".ad-form","fieldset"),s(!0,".map__filters","select");const d=document.querySelector(".map__filters"),i=L.map("mapCanvas").on("load",(()=>{s(!1,".ad-form"),console.log("загрузилось")})).setView({lat:35.67,lng:139.75},10);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(i);const p=L.icon({iconUrl:"img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),f=L.marker({lat:35.67842,lng:139.76102},{draggable:!0,icon:p});f.addTo(i);const m=document.querySelector("#housing-type"),y=document.querySelector("#housing-price"),v=document.querySelector("#housing-rooms"),h=document.querySelector("#housing-guests"),g=document.querySelector("#housing-features").querySelectorAll(".map__checkbox"),S=e=>{let t=function(){let e=[];return g.forEach((t=>{t.checked&&e.push(t.value)})),e}(),o=0,r=0;return"any"===y.value?o+=2:("low"===y.value&&e.offer.price<1e4&&(o+=2),"middle"===y.value&&e.offer.price>=1e4&&e.offer.price<5e4&&(o+=2),"high"===y.value&&e.offer.price>=5e4&&(o+=2)),!e.offer.features&&0===t.length||0===t.length?o+=1:e.offer.features?t.forEach((n=>{var a,c;a=e.offer.features,c=n,a.some((e=>c===e))&&(r+=1),r==t.length&&(o+=1)})):o+=0,"any"!==m.value&&m.value!==e.offer.type||(o+=1),"any"===v.value||v.value==e.offer.rooms?o+=1:("1"===v.value&&e.offer.rooms>=1&&(o+=1),"2"===v.value&&e.offer.rooms>=2&&(o+=1),"3"===v.value&&e.offer.rooms>=3&&(o+=1)),"any"===h.value||h.value==e.offer.guests?o+=1:("2"===h.value&&e.offer.guests>=2&&(o+=1),"1"===h.value&&e.offer.guests>=1&&(o+=1),"0"===h.value&&e.offer.guests>=0&&(o+=1)),o},_=(e,t)=>{const o=S(e);e.rank=o;const r=S(t);return t.rank=r,r-o},q=function(e){L.marker({lat:35.67842,lng:139.76102},{draggable:!0,icon:p}).addTo(i);const t=L.icon({iconUrl:"img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]});let o=e.slice().sort(_);o.forEach(((e,t)=>{e.rank<6&&o.splice(t,o.length-1)})),o.slice(0,E).forEach((({location:e},r)=>{L.marker({lat:e.lat,lng:e.lng},{icon:t}).addTo(i).bindPopup(w(r,o),{keepInView:!0})}))},b=document.querySelector("#address");b.value="35.67842, 139.76102",f.on("moveend",(e=>{let t=Object.values(e.target.getLatLng());t[0]=t[0].toFixed(5),t[1]=t[1].toFixed(5),b.value=t}));const k=function(e){const t=document.querySelector("#error").content.querySelector(".error").cloneNode("true"),o=document.querySelector("body");t.querySelector(".error__message").textContent=e,o.appendChild(t),t.querySelector(".error__button").addEventListener("click",(()=>{t.remove()})),document.addEventListener("keydown",(function(e){27===e.keyCode&&t.remove()}))},C=document.querySelector(".ad-form");C.addEventListener("submit",(e=>{e.preventDefault();const t=new FormData(e.target),o=document.querySelector(".map__filters");fetch("https://23.javascript.pages.academy/keksobooking",{method:"POST",body:t}).then((e=>{e.ok?(o.reset(),C.reset(),f.setLatLng({lat:35.67842,lng:139.76102}),b.value="35.67842, 139.76102",function(e){const t=document.querySelector("#success").content.querySelector(".success").cloneNode("true"),o=document.querySelector("body");t.querySelector(".success__message").textContent="Форма успешно отправлена",o.appendChild(t),document.addEventListener("click",(()=>{t.remove()})),document.addEventListener("keydown",(function(e){27===e.keyCode&&t.remove()}))}()):k("Не удалось отправить форму. Попробуйте ещё раз")})).catch((()=>{k("Не удалось отправить форму. Попробуйте ещё раз")}))}));const w=function(e,t){const o=document.querySelector("#card").content.querySelector(".popup").cloneNode(!0);o.querySelector(".popup__avatar").src=t[e].author.avatar,o.querySelector(".popup__title").textContent=t[e].offer.title,o.querySelector(".popup__text--price").innerHTML=t[e].offer.price+"<span>₽/ночь</span>",o.querySelector(".popup__type").textContent=t[e].offer.type,o.querySelector(".popup__text--capacity").textContent=t[e].offer.rooms+" комнат(ы) "+t[e].offer.guests+" гостей",o.querySelector(".popup__text--time").textContent="Заезд после "+t[e].offer.checkin+", выезд до "+t[e].offer.checkout,o.querySelector(".popup__description").textContent=t[e].offer.description;let r=o.querySelector(".popup__features");t[e].offer.features?(t[e].offer.features.includes("wifi")||r.querySelector(".popup__feature--wifi").remove(),t[e].offer.features.includes("dishwasher")||r.querySelector(".popup__feature--dishwasher").remove(),t[e].offer.features.includes("parking")||r.querySelector(".popup__feature--parking").remove(),t[e].offer.features.includes("washer")||r.querySelector(".popup__feature--washer").remove(),t[e].offer.features.includes("elevator")||r.querySelector(".popup__feature--elevator").remove(),t[e].offer.features.includes("conditioner")||r.querySelector(".popup__feature--conditioner").remove()):r.remove();const n=o.querySelector(".popup__photos"),a=o.querySelector(".popup__photo");return t[e].offer.photos?(a.remove(),t[e].offer.photos.forEach((e=>{const t=a.cloneNode(!0);t.src=e,n.appendChild(t)}))):n.remove(),o},E=10;var x,V;(x=e=>{var t;s(!1,".ad-form","fieldset"),s(!1,".map__filters","select"),q(e),t=()=>q(e),d.addEventListener("change",(()=>{document.querySelector(".leaflet-marker-pane").innerHTML="",t()}))},V=e=>{k("Ошибка работы сервера. Объявления не будут отображены на карте")},()=>fetch("https://23.javascript.pages.academy/keksobooking/data").then((e=>{if(e.ok)return s(!1,".map__filters","select"),e.json()})).then((e=>{console.log("reload"),x(e)})).catch((e=>{V()})))()})();
//# sourceMappingURL=main.bundle.js.map